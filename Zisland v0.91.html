<!DOCTYPE html>
<html>
<head>	<title>Z island</title>

<script type="text/javascript">
var h=0; d=0; jx=0; jy=0; TheX=0; TheY=0;   


var StX=[];  var StY=[];  var Lx=[];  var Ly=[];	var Switch=1; var ZOM=3;

 

	addEventListener("keydown", (key) => {					// Key press event
		if(key.keyCode == 38 ){up();}						// Up
		if(key.keyCode == 37 ){left();}						// Left
		if(key.keyCode == 39 ){right();}					// Right
		if(key.keyCode == 40 ){down();}						// Down
	});



var Name=[];	var PosX=[];	var PosY=[];	var DirX=[];	var DirY=[];	var MinX=[]; 	var MaxX=[];	var MinY=[]; 	var MaxY=[];	var Vits=[];
Name[0]="Jimmy";	PosX[0]=60;		PosY[0]=60;		DirX[0]=0;	DirY[0]=0;		MinX[0]=0;		MaxX[0]=0;		MinY[0]=10;		MaxY[0]=290;	Vits[0]=0;
Name[1]="Zombie1";	PosX[1]=200;	PosY[1]=200;	DirX[1]=1;	DirY[1]=1;		MinX[1]=10;		MaxX[1]=490;	MinY[1]=10;		MaxY[1]=290;	Vits[1]=1;
Name[2]="Zombie2";	PosX[2]=200;	PosY[2]=200;	DirX[2]=1;	DirY[2]=1;		MinX[2]=10;		MaxX[2]=490;	MinY[2]=10;		MaxY[2]=290;	Vits[2]=1;
Name[3]="Zombie3";	PosX[3]=200;	PosY[3]=200;	DirX[3]=1;	DirY[3]=1;		MinX[3]=10;		MaxX[3]=490;	MinY[3]=10;		MaxY[3]=290;	Vits[3]=1;
Name[4]="Zombie3";	PosX[4]=200;	PosY[4]=200;	DirX[4]=1;	DirY[4]=1;		MinX[4]=10;		MaxX[4]=490;	MinY[4]=10;		MaxY[4]=290;	Vits[4]=1;
Name[5]="Zombie3";	PosX[5]=200;	PosY[5]=200;	DirX[5]=1;	DirY[5]=1;		MinX[5]=10;		MaxX[5]=490;	MinY[5]=10;		MaxY[5]=290;	Vits[5]=1;
Name[6]="Zombie3";	PosX[6]=200;	PosY[6]=200;	DirX[6]=1;	DirY[6]=1;		MinX[6]=10;		MaxX[6]=490;	MinY[6]=10;		MaxY[6]=290;	Vits[6]=1;

function Rectangle(c,x,y,l,h)				{c.fillRect (x,y,l,h);}
function Clean(c) 							{c.fillStyle = "white";	c.fillRect (0, 0, 500, 300);}
function GreenSetup(c) 						{c.fillStyle = "ForestGreen";	c.fillRect (0, 0, 500, 300);}
function BlueSetup(c) 						{c.fillStyle = "LightSkyBlue";	c.fillRect (0, 0, 500, 300);}
function YellowSetup(c) 					{c.fillStyle = "Moccasin";		c.fillRect (0, 0, 500, 300);}
function Triangle(c,x1,y1,x2,y2,x3,y3)		{c.beginPath();	c.moveTo(x1,y1);	c.lineTo(x2,y2);	c.lineTo(x3,y3);	c.fill();}
function Cercle(c,x,y,r) 					{c.beginPath();	c.arc(x, y, r, 0, Math.PI*2, true);	c.closePath(); c.fill();}
function Trait(c,x1,y1,x2,y2,col) 			{c.beginPath(); c.moveTo(x1,y1);	c.lineTo(x2,y2);  c.strokeStyle = col;	c.stroke();}	
function DontFuckingTouchMe()				{d=0; for(i=1;i<=ZOM;i++){if(Dist(i,0)<20){d=1;}}	}
function Dist(a,b)							{return Dista=Math.round(Math.sqrt((PosX[a]-PosX[b])*(PosX[a]-PosX[b])+(PosY[a]-PosY[b])*(PosY[a]-PosY[b])));}
function up()								{if(CheckColor(PosX[0],PosY[0]-13)!=765){PosY[0]-=2;}}
function down()								{if(CheckColor(PosX[0],PosY[0]+7)!=765) {PosY[0]+=2;}}
function left()								{if(CheckColor(PosX[0]-10,PosY[0])!=765){PosX[0]-=2;}}
function right()							{if(CheckColor(PosX[0]+10,PosY[0])!=765){PosX[0]+=2;}}
function ReloadZombies()					{for(n=1;n<=ZOM;n++){PosX[n]=200; PosY[n]=200;}}
function GetInput()							{ZOM=document.getElementById("ZOM").value;}
function CheckColor(x,y){  
	var imgd = ctx2.getImageData(x, y, 1, 1);
	var pix = imgd.data;
	   pix[0] = 255 - pix[0]; // red
	   pix[1] = 255 - pix[1]; // green
	   pix[2] = 255 - pix[2]; // blue
	   return total=pix[0]+pix[1]+pix[2];
}
function Structures(){ 
	for(n=1;n<4;n++){
	if(Math.random()>0.5){LorL=1;} else{LorL=0;}
	Long=50;
	StX[n]=Math.round(Math.random()*400+50);
	StY[n]=Math.round(Math.random()*200+50);
	if(LorL==1){Lx[n]=Long;}  else{Lx[n]=5;}
	if(LorL==0){Ly[n]=Long;}  else{Ly[n]=5;}
}}
function BuildStructures(){
ctx2.fillStyle ="black"; Rectangle(ctx2,StX[1],StY[1],Lx[1],Ly[1]);
ctx2.fillStyle ="black"; Rectangle(ctx2,StX[2],StY[2],Lx[2],Ly[2]);
ctx2.fillStyle ="black"; Rectangle(ctx2,StX[3],StY[3],Lx[3],Ly[3]);
}



function DrawHead(){
ctx1 = document.getElementById('canvas1').getContext('2d');
ctx1.fillStyle ="grey";  Rectangle(ctx1,0,0,500,50);

ctx1.fillStyle ="orange";
ctx1.font="2em Helvetica";
ctx1.fillText("Z island v0.91",10,35);

ctx1.fillStyle ="black";   Cercle(ctx1,350,30-7.5,5);	ctx1.lineWidth = 2;	Trait(ctx1,350,30-5,350+10,30+5,"black");	Trait(ctx1,350,30-5,350-10,30+5,"black");	Trait(ctx1,350,30+5,350+5,30+10,"black");	Trait(ctx1,350,30+5,350-5,30+10,"black");	ctx1.lineWidth = 4;		Trait(ctx1,350,30-5,350,30+5,"black");
ctx1.fillStyle ="red";   Cercle(ctx1,400-4,30-7.5,4);	ctx1.lineWidth = 2;	Trait(ctx1,400-4,30-5,400+10,30-3,"red");	Trait(ctx1,400-4,30-1,400+10,30+1,"red");	Trait(ctx1,400-4,30+3,400-6,30+10,"red");	Trait(ctx1,400-4,30+3,400+0,30+10,"red");	ctx1.lineWidth = 4;		Trait(ctx1,400-4,30-5,400-4,30+3,"red");
}



function drawShape(){  
ctx2 = document.getElementById('canvas2').getContext('2d');
Clean(ctx2);



if(TheX==0 && TheY==0){
	YellowSetup(ctx2);
	if(Switch==1){Structures(); Switch=0;}	BuildStructures();
	ctx2.fillStyle ="black"; Rectangle(ctx2,0,0,500,20);
	ctx2.fillStyle ="black"; Rectangle(ctx2,0,0,20,300);} 

if(TheX==1 && TheY==0){
	YellowSetup(ctx2);
	if(Switch==1){Structures(); Switch=0;}	BuildStructures();
	ctx2.fillStyle ="black"; Rectangle(ctx2,0,0,500,20);}

if(TheX==2 && TheY==0){
	YellowSetup(ctx2);
	if(Switch==1){Structures(); Switch=0;}	BuildStructures();
	ctx2.fillStyle ="black"; Rectangle(ctx2,0,0,500,20);
	ctx2.fillStyle ="black"; Rectangle(ctx2,480,0,20,300);}

if(TheX==0 && TheY==1){
	GreenSetup(ctx2);
	if(Switch==1){Structures(); Switch=0;}	BuildStructures();
	ctx2.fillStyle ="black"; Rectangle(ctx2,0,0,20,300);}

if(TheX==1 && TheY==1){
	GreenSetup(ctx2);
	if(Switch==1){Structures(); Switch=0;}	BuildStructures();}

if(TheX==2 && TheY==1){
	GreenSetup(ctx2);
	if(Switch==1){Structures(); Switch=0;}	BuildStructures();
	ctx2.fillStyle ="black"; Rectangle(ctx2,480,0,20,300);}

if(TheX==0 && TheY==2){
	BlueSetup(ctx2);
	if(Switch==1){Structures(); Switch=0;}	BuildStructures();
	ctx2.fillStyle ="black"; Rectangle(ctx2,0,0,20,300);
	ctx2.fillStyle ="black"; Rectangle(ctx2,0,280,500,20);}

if(TheX==1 && TheY==2){
	BlueSetup(ctx2);
	if(Switch==1){Structures(); Switch=0;}	BuildStructures();
	ctx2.fillStyle ="black"; Rectangle(ctx2,0,280,500,20);}

if(TheX==2 && TheY==2){
	BlueSetup(ctx2);
	if(Switch==1){Structures(); Switch=0;}	BuildStructures();
	ctx2.fillStyle ="black"; Rectangle(ctx2,480,0,20,300);
	ctx2.fillStyle ="black"; Rectangle(ctx2,0,280,500,20);}





















if(PosX[0]>480){PosX[0]=30;  TheX++;	ReloadZombies();	Switch=1;}
if(PosY[0]>280){PosY[0]=30;	 TheY++;	ReloadZombies();	Switch=1;}
if(PosX[0]<20) {PosX[0]=470; TheX--;	ReloadZombies();	Switch=1;}
if(PosY[0]<20) {PosY[0]=270; TheY--;	ReloadZombies();	Switch=1;}

	ctx2.fillStyle ="black";   Cercle(ctx2,PosX[0],PosY[0]-7.5,5);
	ctx2.lineWidth = 2;
	Trait(ctx2,PosX[0],PosY[0]-5,PosX[0]+10,PosY[0]+5,"black");
	Trait(ctx2,PosX[0],PosY[0]-5,PosX[0]-10,PosY[0]+5,"black");
	Trait(ctx2,PosX[0],PosY[0]+5,PosX[0]+5,PosY[0]+10,"black");
	Trait(ctx2,PosX[0],PosY[0]+5,PosX[0]-5,PosY[0]+10,"black");
	ctx2.lineWidth = 4;
	Trait(ctx2,PosX[0],PosY[0]-5,PosX[0],PosY[0]+5,"black");


//Dist=Math.round(Math.sqrt((PosX[i]-jx)*(PosX[i]-jx)+(PosY[i]-jy)*(PosY[i]-jy)));


//Gestion du mouvement des zombies
for(i=1;i<=ZOM;i++){ 
	if(Math.random()>0.99){DirX[i]=DirX[i]*-1;} 
	if(Math.random()>0.99){DirY[i]=DirY[i]*-1;}
	if(PosX[i]>MaxX[i]){DirX[i]=-1;} 	if(PosX[i]<MinX[i]){DirX[i]=1;} 
	if(PosY[i]>MaxY[i]){DirY[i]=-1;} 	if(PosY[i]<MinY[i]){DirY[i]=1;}
	
	if(CheckColor(PosX[i]+DirX[i]+(DirX[i]*5),PosY[i])!=765){PosX[i]=PosX[i]+DirX[i];}          //Avance avec test de non-mur    
	if(CheckColor(PosX[i],PosY[i]+DirY[i]+(DirY[i]*5))!=765){PosY[i]=PosY[i]+DirY[i];}			//Avance avec test de non-mur    
	
	//ctx2.fillStyle ="red";   Cercle(ctx2,PosX[i],PosY[i],10);
	if(DirX[i]==1){
	ctx2.fillStyle ="red";   Cercle(ctx2,PosX[i]-4,PosY[i]-7.5,4);
	ctx2.lineWidth = 2;
	Trait(ctx2,PosX[i]-4,PosY[i]-5,PosX[i]+10,PosY[i]-3,"red");
	Trait(ctx2,PosX[i]-4,PosY[i]-1,PosX[i]+10,PosY[i]+1,"red");
	Trait(ctx2,PosX[i]-4,PosY[i]+3,PosX[i]-6,PosY[i]+10,"red");
	Trait(ctx2,PosX[i]-4,PosY[i]+3,PosX[i]+0,PosY[i]+10,"red");
	ctx2.lineWidth = 4;	Trait(ctx2,PosX[i]-4,PosY[i]-5,PosX[i]-4,PosY[i]+3,"red");
	}
	if(DirX[i]==-1){
	ctx2.fillStyle ="red";   Cercle(ctx2,PosX[i]+4,PosY[i]-7.5,4);
	ctx2.lineWidth = 2;
	Trait(ctx2,PosX[i]+4,PosY[i]-5,PosX[i]-10,PosY[i]-3,"red");
	Trait(ctx2,PosX[i]+4,PosY[i]-1,PosX[i]-10,PosY[i]+1,"red");
	Trait(ctx2,PosX[i]+4,PosY[i]+3,PosX[i]+6,PosY[i]+10,"red");
	Trait(ctx2,PosX[i]+4,PosY[i]+3,PosX[i]+0,PosY[i]+10,"red");
	ctx2.lineWidth = 4;	Trait(ctx2,PosX[i]+4,PosY[i]-5,PosX[i]+4,PosY[i]+3,"red");
	}
}



DontFuckingTouchMe();





if(d==0) {requestAnimationFrame(drawShape);}
else{ctx2.fillStyle ="orange";	ctx2.font="5em Helvetica";	ctx2.fillText("GAME OVER",7,200);}	
}




</script>
</head>
<body onload="DrawHead(); drawShape();">
<h1> Z island by DrJW</h1>
<div style="border-top: solid 1px black"></div>
<a href='#' onclick='location.reload(true); return false;'><canvas id="canvas1" width="500px" height="50px" ></canvas><br></a>
<canvas id="canvas2" width="500px" height="300px" ></canvas><br>

<table><tr><td>
<table><tr><td></td><td>
<input type=button value="^" id="kup" 		onclick="up()"  	style="height:40px; width:40px;  background-color:white; border: 2px solid black">
</td><td></td></tr><tr><td>
<input type=button value="<" id="kleft" 	onclick="left()" 	style="height:40px; width:40px;  background-color:white; border: 2px solid black">
</td><td></td><td>
<input type=button value=">" id="kright" 	onclick="right()" 	style="height:40px; width:40px;  background-color:white; border: 2px solid black">
</td></tr><tr><td></td><td>
<input type=button value="v" id="kdown" 	onclick="down()" 	style="height:40px; width:40px;  background-color:white; border: 2px solid black">
</td><td></td></tr>
</table>

</td><td>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp </td><td>
<form>Zombies :<select id="ZOM" size=\"1\"><option>3</option> <option>4</option> <option>5</option> <option>6</option>  </select></form>  <input type=button style="background-color:orange" value="Validate" onclick="GetInput(); ">
</td></tr></table>

</body> 
